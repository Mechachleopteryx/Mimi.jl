<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Composite Components · Mimi.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Mimi.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../installation/">Installation Guide</a></li><li><a class="tocitem" href="../../userguide/">User Guide</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/tutorial_main/">Tutorials Intro</a></li><li><a class="tocitem" href="../../tutorials/tutorial_1/">1 Run an Existing Model</a></li><li><a class="tocitem" href="../../tutorials/tutorial_2/">2 Modify an Existing Model</a></li><li><a class="tocitem" href="../../tutorials/tutorial_3/">3 Create a Model</a></li><li><a class="tocitem" href="../../tutorials/tutorial_4/">4 Sensitivity Analysis</a></li></ul></li><li><a class="tocitem" href="../../faq/">FAQ</a></li><li><a class="tocitem" href="../../reference/">Reference</a></li><li><a class="tocitem" href="../../integrationguide/">Integration Guide: Port to v0.5.0</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Composite Components</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Composite Components</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/mimiframework/Mimi.jl/blob/master/docs/src/internals/composite_components.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Composite-Components-1"><a class="docs-heading-anchor" href="#Composite-Components-1">Composite Components</a><a class="docs-heading-anchor-permalink" href="#Composite-Components-1" title="Permalink"></a></h1><h2 id="Goals-1"><a class="docs-heading-anchor" href="#Goals-1">Goals</a><a class="docs-heading-anchor-permalink" href="#Goals-1" title="Permalink"></a></h2><p>In Mimi v0.4, we have two levels of model elements, (i) <code>Model</code> and (ii) <code>Component</code>. (For now, we ignore the distinction between model / component &quot;definition&quot; and &quot;instance&quot; types.) The primary goal of the <code>MetaComponent</code> construct is to extend this structure recursively to <em>N</em> levels, by allowing a <code>MetaComponent</code> to contain other <code>MetaComponent</code>s as well as <code>LeafComponent</code>s, which cannot contain other components.</p><h2 id="Major-elements-1"><a class="docs-heading-anchor" href="#Major-elements-1">Major elements</a><a class="docs-heading-anchor-permalink" href="#Major-elements-1" title="Permalink"></a></h2><p>This suggests three types of elements:</p><ol><li><p><code>LeafComponent(Def|Instance)</code> – equivalent to the Mimi v0.4 <code>Component(Def|Instance)</code> concept.</p></li><li><p><code>MetaComponent(Def|Instance)</code> – presents the same API as a <code>LeafComponent(Def|Instance)</code>, but the variables and parameters it exposes are the aggregated sets of variables and parameters exposed by its components, each of which can be a <code>MetaComponent</code> or <code>LeafComponent</code>. A <code>MetaComponentInstance</code> creates no new storage for variables and parameters; it references the storage in its internal components. By default, the <code>run_timestep</code> method of a <code>MetaComponentInstance</code> simply calls the <code>run_timestep</code> method of each of its internal components in dependency order. </p></li><li><p><code>Model</code> – Contains a top-level <code>MetaComponentInstance</code> that holds all the actual user-defined components, which are instances of <code>MetaComponentInstance</code> or <code>LeafComponentInstance</code>. The API for <code>Model</code> delegates some calls to its top-level <code>MetaComponentInstance</code> while providing additional functionality including running a Monte Carlo simulation.</p></li></ol><h2 id="Implementation-Notes-1"><a class="docs-heading-anchor" href="#Implementation-Notes-1">Implementation Notes</a><a class="docs-heading-anchor-permalink" href="#Implementation-Notes-1" title="Permalink"></a></h2><h3 id="Model-1"><a class="docs-heading-anchor" href="#Model-1">Model</a><a class="docs-heading-anchor-permalink" href="#Model-1" title="Permalink"></a></h3><ul><li><p>A <code>Model</code> will be defined using the <code>@defmodel</code> macro.</p></li><li><p>As with the currently defined (but not exported) <code>@defmodel</code>, component ordering will be determined automatically based on defined connections, with loops avoided by referencing timestep <code>[t-1]</code>. This simplifies the API for <code>addcomponent!</code>.</p></li><li><p>We will add support for two optional functions defined inside <code>@defmodel</code>:</p><ul><li><code>before(m::Model)</code>, called before the model runs its first timestep</li><li><code>after(m:Model)</code>, called after the model runs its final timestep.</li></ul></li><li><p>A <code>Model</code> will be implemented as a wrapper around a single top-level <code>MetaComponent</code> that handles the ordering and iteration over sub-components. (In an OOP language, <code>Model</code> would subclass <code>MetaComponent</code>, but in Julia, we use composition.)</p></li></ul><p><img src="../../figs/Mimi-model-schematic-v3.png" alt="MetaComponent Schematic"/></p><h3 id="MetaComponent-1"><a class="docs-heading-anchor" href="#MetaComponent-1">MetaComponent</a><a class="docs-heading-anchor-permalink" href="#MetaComponent-1" title="Permalink"></a></h3><ul><li><p>Defined using <code>@defcomp</code> as with <code>LeafComponent</code>. It&#39;s &quot;meta&quot; nature is defined by including a new term:</p><p><code>subcomps = [sc1, sc2, sc3, ...]</code>, where the referenced sub-components (<code>sc1</code>, etc.) refer to previously defined <code>ComponentId</code>s.</p></li><li><p>A <code>MetaComponent</code>&#39;s <code>run_timestep</code> function is optional. The default function simply calls <code>run_timestep(subcomps::Vector)</code> to iterate over sub-components and calls <code>run_timestep</code> on each. If a <code>MetaComponent</code> defines its own <code>run_timestep</code> function, it should either call <code>run_timestep</code> on the vector of sub-components or perform a variant of this function itself.</p></li><li><p>The <code>@defcomp</code> macro allows definition of an optional <code>init</code> method. To this, we will add support for an <code>after</code> method as in <code>@defmodel</code>. We will allow <code>before</code> as an alias for <code>init</code> (perhaps with a deprecation) for consistency with <code>@defmodel</code>.</p></li></ul><h2 id="Other-Notes-1"><a class="docs-heading-anchor" href="#Other-Notes-1">Other Notes</a><a class="docs-heading-anchor-permalink" href="#Other-Notes-1" title="Permalink"></a></h2><ul><li><p>Currently, <code>run()</code> calls <code>_run_components(mi, clock, firsts, lasts, comp_clocks)</code> with simple vectors of firsts, lasts, and comp_clocks. To handle this with the recursive component structure:</p><ul><li><p>Aggregate from the bottom up building <code>_firsts</code> and <code>_lasts</code> in each <code>MetaComponentInstance</code> holding the values for its sub-components.</p></li><li><p>Also store the <code>MetaComponentInstance</code>&#39;s own summary <code>first</code> and <code>last</code> which are just <code>min(firsts)</code> and <code>max(lasts)</code>, respectively.</p></li></ul></li><li><p>Currently, the <code>run()</code> function creates a vector of <code>Clock</code> instances, corresponding to each model component. I see two options here:</p><ol><li><p>Extend the current approach to have each <code>MetaComponentInstance</code> hold a vector of <code>Clock</code> instances for its sub-components.</p></li><li><p>Store a <code>Clock</code> instance with each <code>MetaComponentInstance</code> or <code>LeafComponentInstance</code> and provide a recursive method to reset all clocks.</p></li></ol></li></ul><h3 id="Other-stuff-1"><a class="docs-heading-anchor" href="#Other-stuff-1">Other stuff</a><a class="docs-heading-anchor-permalink" href="#Other-stuff-1" title="Permalink"></a></h3><ul><li><p>This might be is a good time to reconsider the implementation of external parameters. The main question is about naming these and whether they need to be globally unique or merely unique within a (meta) component.</p></li><li><p>Unit conversion components should be simple &quot;multiplier&quot; components that are bound with specific conversion factors, conceptually like a &quot;closure&quot; on a component.</p></li><li><p>An &quot;identity&quot; component takes an input (external input, bound constant) and allows multiple components to access it. One issue is how to handle the type of argument. Could function wrappers be useful here?</p><ul><li>Identity is simply a unit conversion of 1.</li></ul></li><li><p>If &gt; 1 component exports parameters of the same name, it&#39;s an error. At least one comp must rename.</p></li><li><p>David suggested making composite comps immutable, generating a new one each time a change is made. (Why not just have the CompositeComponentInstance be immutable?)</p></li></ul><h2 id="Notes-from-9/21/18-Meeting-1"><a class="docs-heading-anchor" href="#Notes-from-9/21/18-Meeting-1">Notes from 9/21/18 Meeting</a><a class="docs-heading-anchor-permalink" href="#Notes-from-9/21/18-Meeting-1" title="Permalink"></a></h2><pre><code class="language-none">@defcomp foo begin
  Component(bar; export=[var_1, var_2, param_1])
  Component(Mimi.adder, comp_1;         # rename locally as :comp_1
            bind=[par_3 =&gt; 5,           # set a parameter to a fixed value
                  par_4 =&gt; bar.var_1])  # connect a parameter to a variable


end</code></pre></article></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 3 March 2020 21:29">Tuesday 3 March 2020</span>. Using Julia version 1.3.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>

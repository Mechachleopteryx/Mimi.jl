<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>1 Construct + Run a Model · Mimi.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Mimi.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/tutorial_main/">Tutorials Intro</a></li><li><a class="tocitem" href="../../tutorials/tutorial_1/">1 Install Mimi</a></li><li><a class="tocitem" href="../../tutorials/tutorial_2/">2 Run an Existing Model</a></li><li><a class="tocitem" href="../../tutorials/tutorial_3/">3 Modify an Existing Model</a></li><li><a class="tocitem" href="../../tutorials/tutorial_4/">4 Create a Model</a></li><li><a class="tocitem" href="../../tutorials/tutorial_5/">5 Monte Carlo + Sensitivity Analysis</a></li></ul></li><li><span class="tocitem">How-to Guides</span><ul><li><a class="tocitem" href="../howto_main/">How-to Guides Intro</a></li><li class="is-active"><a class="tocitem" href>1 Construct + Run a Model</a><ul class="internal"><li><a class="tocitem" href="#Defining-Components-1"><span>Defining Components</span></a></li><li><a class="tocitem" href="#Constructing-a-Model-1"><span>Constructing a Model</span></a></li><li><a class="tocitem" href="#Running-a-Model-1"><span>Running a Model</span></a></li></ul></li><li><a class="tocitem" href="../howto_2/">2 Explore Results</a></li><li><a class="tocitem" href="../howto_3/">3 Monte Carlo + SA</a></li><li><a class="tocitem" href="../howto_4/">4 Timesteps, Params, and Vars</a></li><li><a class="tocitem" href="../howto_5/">5 Port to v0.5.0</a></li><li><a class="tocitem" href="../howto_6/">6 Port to v1.0.0</a></li></ul></li><li><span class="tocitem">Advanced How-to Guides</span><ul><li><a class="tocitem" href="../../howto_advanced/howto_adv_main/">Advanced How-to Guides Intro</a></li><li><a class="tocitem" href="../../howto_advanced/howto_adv_buildinit/">Build and Init Functions</a></li><li><a class="tocitem" href="../../howto_advanced/howto_adv_datumrefs/">Using Datum References</a></li></ul></li><li><span class="tocitem">Reference Guides</span><ul><li><a class="tocitem" href="../../ref/ref_main/">Reference Guides Intro</a></li><li><a class="tocitem" href="../../ref/ref_API/">Mimi API</a></li><li><a class="tocitem" href="../../ref/ref_structures/">Structures</a></li><li><a class="tocitem" href="../../ref/ref_structures_definitions/">Structures: Definitions</a></li><li><a class="tocitem" href="../../ref/ref_structures_instances/">Structures: Instances</a></li></ul></li><li><a class="tocitem" href="../../faq/">FAQ</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">How-to Guides</a></li><li class="is-active"><a href>1 Construct + Run a Model</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>1 Construct + Run a Model</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/mimiframework/Mimi.jl/blob/master/docs/src/howto/howto_1.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="How-to-Guide-1:-Construct-and-Run-a-Model-1"><a class="docs-heading-anchor" href="#How-to-Guide-1:-Construct-and-Run-a-Model-1">How-to Guide 1: Construct and Run a Model</a><a class="docs-heading-anchor-permalink" href="#How-to-Guide-1:-Construct-and-Run-a-Model-1" title="Permalink"></a></h1><p>This how-to guide pairs nicely with Tutorial 4: Create a Model, serving as an abbreviated, less-detailed version and refresher for those with some experience with Mimi. If this is your first time constructing and running a Mimi model, we recommend you start with Tutorial 4, which will give you more detailed step-by step instructions.</p><h2 id="Defining-Components-1"><a class="docs-heading-anchor" href="#Defining-Components-1">Defining Components</a><a class="docs-heading-anchor-permalink" href="#Defining-Components-1" title="Permalink"></a></h2><p>Any Mimi model is made up of at least one component, so before you construct a model, you need to create your components.</p><p>A component can have any number of parameters and variables. Parameters are data values that will be provided to the component as input, and variables are values that the component will calculate in the <code>run_timestep</code> function when the model is run. The index of a parameter or variable determines the number of dimensions that parameter or variable has. They can be scalar values and have no index, such as parameter &#39;c&#39; in the example below. They can be one-dimensional, such as the variable &#39;A&#39; and the parameters &#39;d&#39; and &#39;f&#39; below. They can be two dimensional such as variable &#39;B&#39; and parameter &#39;e&#39; below. Note that any index other than &#39;time&#39; must be declared at the top of the component, as shown by <code>regions = Index()</code> below.</p><p>The user must define a <code>run_timestep</code> function for each component. </p><p>We define a component in the following way:</p><pre><code class="language-julia">using Mimi

@defcomp MyComponentName begin
  regions = Index()

  A = Variable(index = [time])
  B = Variable(index = [time, regions])

  c = Parameter()
  d = Parameter(index = [time])
  e = Parameter(index = [time, regions])
  f = Parameter(index = [regions])

  function run_timestep(p, v, d, t)
    v.A[t] = p.c + p.d[t]
    for r in d.regions
      v.B[t, r] = p.f[r] * p.e[t, r]
    end
  end
end</code></pre><p>The <code>run_timestep</code> function is responsible for calculating values for each variable in that component.  Note that the component state (defined by the first three arguments) has fields for the Parameters, Variables, and Dimensions of the component you defined. You can access each parameter, variable, or dimension using dot notation as shown above.  The fourth argument is an <code>AbstractTimestep</code>, i.e., either a <code>FixedTimestep</code> or a <code>VariableTimestep</code>, which represents which timestep the model is at.</p><p>The API for using the fourth argument, represented as <code>t</code> in this explanation, is described in a following how-to guide How-to Guide 4: Work with Timesteps, Parameters, and Variables. </p><p>To access the data in a parameter or to assign a value to a variable, you must use the appropriate index or indices (in this example, either the Timestep or region or both).</p><p>By default, all parameters and variables defined in the <code>@defcomp</code> will be allocated storage as scalars or Arrays of type <code>Float64.</code> For a description of other data type options, see How-to Guide 4: Work with Timesteps, Parameters, and Variables </p><h2 id="Constructing-a-Model-1"><a class="docs-heading-anchor" href="#Constructing-a-Model-1">Constructing a Model</a><a class="docs-heading-anchor-permalink" href="#Constructing-a-Model-1" title="Permalink"></a></h2><p>The first step in constructing a model is to set the values for each index of the model. Below is an example for setting the &#39;time&#39; and &#39;regions&#39; indexes. The time index expects either a numerical range or an array of numbers.  If a single value is provided, say &#39;100&#39;, then that index will be set from 1 to 100. Other indexes can have values of any type.</p><pre><code class="language-julia">using Mimi

m = Model()
set_dimension!(m, :time, 1850:2200)
set_dimension!(m, :regions, [&quot;USA&quot;, &quot;EU&quot;, &quot;LATAM&quot;])</code></pre><p><em>A Note on Time Indexes:</em> It is important to note that the values used for the time index are the <em>start times</em> of the timesteps.  If the range or array of time values has a uniform timestep length, the model will run <em>through</em> the last year of the range with a last timestep period length consistent with the other timesteps.  If the time values are provided as an array with non-uniform timestep lengths, the model will run <em>through</em> the last year in the array with a last timestep period length <em>assumed to be one</em>. </p><p>The next step is to add components to the model. This is done by the following syntax:</p><pre><code class="language-julia">add_comp!(m, ComponentA)
add_comp!(m, ComponentA, :GDP)</code></pre><p>The first argument to <code>add_comp!</code> is the model, the second is the name of the ComponentId defined by <code>@defcomp</code>. If an optional third symbol is provided (as in the second line above), this will be used as the name of the component in this model. This allows you to add multiple versions of the same component to a model, with different names.</p><p>The next step is to set the values for all the parameters in the components. Parameters can either have their values assigned from external data, or they can internally connect to the values from variables in other components of the model.</p><p>To make an external connection, the syntax is as follows:</p><pre><code class="language-julia">set_param!(m, :ComponentName, :ParameterName, 0.8) # a scalar parameter
set_param!(m, :ComponentName, :ParameterName2, rand(351, 3)) # a two-dimensional parameter</code></pre><p>To make an internal connection, the syntax is as follows.  </p><pre><code class="language-julia">connect_param!(m, :TargetComponent=&gt;:ParameterName, :SourceComponent=&gt;:VariableName)
connect_param!(m, :TargetComponent=&gt;:ParameterName, :SourceComponent=&gt;:VariableName)</code></pre><p>If you wish to delete a component that has already been added, do the following:</p><pre><code class="language-julia">delete!(m, :ComponentName)</code></pre><p>This will delete the component from the model and remove any existing connections it had. Thus if a different component was previously connected to this component, you will need to connect its parameter(s) to something else.</p><h2 id="Running-a-Model-1"><a class="docs-heading-anchor" href="#Running-a-Model-1">Running a Model</a><a class="docs-heading-anchor-permalink" href="#Running-a-Model-1" title="Permalink"></a></h2><p>After all components have been added to your model and all parameters have been connected to either external values or internally to another component, then the model is ready to be run. Note: at each timestep, the model will run the components in the order you added them. So if one component is going to rely on the value of another component, then the user must add them to the model in the appropriate order.</p><pre><code class="language-julia">run(m)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../howto_main/">« How-to Guides Intro</a><a class="docs-footer-nextpage" href="../howto_2/">2 Explore Results »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 27 October 2020 22:10">Tuesday 27 October 2020</span>. Using Julia version 1.5.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
